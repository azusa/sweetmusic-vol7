
# インフラ自動化における課題

## Conitious Integraion

ビルドやテスト、デプロイの自動化技術を用いて、アプリケーションの結合とリリースを
速いサイクルで行う事により、開発プロセスの最適化とリードサイクルの短縮を
目指す、という試みはソフトウェア開発の歴史の速い段階からあります。
例えば米国コロンビア大学のG. E. Kaiseらが1989年に発表した「Infuse:Infuse: fusing integration test management with change management」[@Kaiser1989]  にその兆しは見ることができます。

「Continous Integration」という語を世に初めて生み出したのはUMLをはじめとするオブジェクト指向
設計の先駆者として知られるGrady Boochとされています。 ^[[https://circleci.com/blog/a-brief-history-of-devops-part-iii-automated-testing-and-continuous-integration/](https://circleci.com/blog/a-brief-history-of-devops-part-iii-automated-testing-and-continuous-integration/)] ^[[https://dzone.com/articles/continuous-integration-and-its-whereabouts](https://dzone.com/articles/continuous-integration-and-its-whereabouts] 彼は「Object-oriented analysis and design with applications(SECOND EDITION)」[@Booch1994] の中で

> The needs of the micro process dictate that many more internal releases to the development team will be accomplished, with only a few executable releases turned over to external parties. These internal releases represent a sort of continous integration of the system, and exist to force closure of the micro process.

と延べ、


## Integration


- スクリプトの結果を確認するには本番環境でEdit and Pray
- dry-runってどこまであてになるの？


## Infrastructure as Code

バージョン管理、自動化、テスティング、チケット管理を柱とするソフトウェア開発の近代化は、現場に生産性の向上や、欠陥の事前の除去による品質の向上など、そしてそれの効果が及ぼすデリバリーのプロセスの改善など、大きな恩恵をもたらしました。

その近代化の動きは仮想化技術や、パブリッククラウドの普及を背景にして、サーバー構築や、ネットワーク構成など、いわゆる「インフラ」と言われる領域にも普及をはじめました。

もともとインフラ構築の分野は、機器のセットアップや、定常業務の運用など、プロセス中に人間が行う作業が介在することを前提とし、それを最適化する方向で発展してきました。

DevOpsというムーブメントの黎明期には、インフラ構築や運用の分野にソフトウェア開発のアプローチを取り入れることにより、プロセスをどう改善していけるかという着眼点が含まれていました。

その代表例が、仮想化技術を前提として、サーバーやネットワーク構成をコード(DSL)で記述することにより、インフラ構築にプログラミングの技法を導入する「Infrastructure as Code」です。

しかしインフラ構築や運用業務を自動化する中で、実装を担当する技術者にソフトウェア開発の経験が乏しいことによる課題も生じています。

特に筆者が経験した現場で共通しているのは、
作成したスクリプトの動作を検証し、本番環境のシステムに配備するまでのプロセスの未整備による、品質面での様々な問題です。

## Infrastructure as Codeにおける開発環境とCIの導入

この章の冒頭にあげましたが、コードの動作を検証する環境が整備されていないため、作成したスクリプトを本番環境で確実に動作することが担保できていない現場の例があります。また継続的インテグレーション(CI)を導入している現場でも、テストがプロビジョニングツールのsyntax check(いわゆる`dry-run`)にとどまり、十分な検証が行われていない例があります。

これらの課題に対応するためには、ソフトウェア開発の現場でデリバリーのプロセスの整備のために行われている取り組みをInfrastructure as Codeの案件にも導入することが解になります。

一つは、スクリプトの作成時に、開発者の手元の環境において、開発者が自由に環境の構築と検証を行えるようにすることです。

また、CI環境において、`dry-run`にとどまらない、実サーバー上での検証を行い、動作の検証済みのスクリプトが本番環境に適用されるよう、プロセスを整備することも重要です。

上記を実現するためのツールの組み合わせとして、本書では

- ローカルでのインフラ構築の仮想環境管理ツールであるVagrant
- 仮想マシンのイメージ構築の自動化ツールであるPacker
- サーバーの構成管理のテストツールであるServerspec

以上のツールを組み合わせた、インフラ構築の自動化の手法を取り上げます。
